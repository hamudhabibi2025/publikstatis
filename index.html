<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASKAB PSSI MENTAWAI</title>
    <!-- Memuat Tailwind CSS untuk styling yang cepat dan elegan -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Menggunakan font Inter sebagai standar yang bersih */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f6;
            color: #1e293b;
        }
        /* Style untuk gambar agar ringan dan menggunakan caching */
        .lazy-img {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover;
            background-color: #e2e8f0; /* Placeholder abu-abu */
        }
        /* Padding untuk konten agar tidak tertutup header dan footer */
        #content-area {
            padding-top: 56px; /* Tinggi header */
            padding-bottom: 72px; /* Tinggi navigasi bawah */
            min-height: 100vh;
        }
        /* Navigasi Bawah */
        #bottom-nav a.active {
            color: #ef4444; /* Warna Merah PSSI */
            border-top: 2px solid #ef4444;
        }
        /* Scrollbar tersembunyi untuk tampilan mobile */
        ::-webkit-scrollbar {
            display: none;
        }
        /* Transisi halus untuk semua elemen interaktif */
        .transition-all {
            transition: all 0.3s ease;
        }
        /* Loader/Skeleton screen style */
        .skeleton {
            animation: pulse 1.5s infinite;
            background-color: #e2e8f0;
            border-radius: 8px;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header (Kepala Halaman) - Fixed Top -->
    <header id="app-header" class="fixed top-0 left-0 right-0 bg-white shadow-md z-40 h-14 flex items-center p-3">
        <!-- Konten Header akan dirender di sini oleh JS -->
    </header>

    <!-- Konten Utama Aplikasi -->
    <main id="content-area" class="p-3">
        <!-- Konten Halaman (Home, Klasemen, Klub, Tentang) akan dirender di sini -->
        <div id="home-page" class="page" data-page="home"></div>
        <div id="klasemen-page" class="page hidden" data-page="klasemen"></div>
        <div id="klub-page" class="page hidden" data-page="klub"></div>
        <div id="tentang-page" class="page hidden" data-page="tentang"></div>
        <div id="klub-detail-page" class="page hidden" data-page="klub-detail"></div>
        <div id="match-detail-page" class="page hidden" data-page="match-detail"></div>
        <div id="loading-overlay" class="fixed inset-0 bg-white/80 flex items-center justify-center z-50 hidden">
            <i class="fa-solid fa-futbol animate-spin text-red-500 text-4xl"></i>
            <span class="ml-3 text-lg font-semibold">Memuat...</span>
        </div>
    </main>

    <!-- Navigasi Bawah (Fixed Bottom) -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-white shadow-2xl z-40 h-16 flex justify-around items-center border-t border-gray-100">
        <a href="#" data-page="home" class="flex flex-col items-center justify-center w-1/4 h-full text-gray-500 active transition-all">
            <i class="fas fa-home text-xl"></i>
            <span class="text-xs mt-1 font-medium">Home</span>
        </a>
        <a href="#" data-page="klasemen" class="flex flex-col items-center justify-center w-1/4 h-full text-gray-500 transition-all">
            <i class="fas fa-list-ol text-xl"></i>
            <span class="text-xs mt-1 font-medium">Klasemen</span>
        </a>
        <a href="#" data-page="klub" class="flex flex-col items-center justify-center w-1/4 h-full text-gray-500 transition-all">
            <i class="fas fa-shield-alt text-xl"></i>
            <span class="text-xs mt-1 font-medium">Klub</span>
        </a>
        <a href="#" data-page="tentang" class="flex flex-col items-center justify-center w-1/4 h-full text-gray-500 transition-all">
            <i class="fas fa-info-circle text-xl"></i>
            <span class="text-xs mt-1 font-medium">Tentang</span>
        </a>
    </nav>

    <!-- Modal Dialog untuk Berita -->
    <div id="news-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden flex items-center justify-center p-4" onclick="closeModal('news-modal')">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-y-auto max-h-[90vh]" onclick="event.stopPropagation()">
            <div id="news-modal-content" class="p-4">
                <!-- Konten berita dimuat di sini -->
            </div>
            <button onclick="closeModal('news-modal')" class="absolute top-2 right-2 p-2 bg-gray-100 rounded-full text-gray-600 hover:text-red-500 transition-all">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>


    <script>
        // ====================================================================
        // 1. DATA PSSI - Diambil dari sheet yang diberikan
        // ====================================================================

        const HEADER_DATA = {
            logo_pssi: "https://i.ibb.co.com/1t4P2rN5/IMG-20251112-015057.jpg",
            Judul_kepala: "ASKAB PSSI PENTAWAI",
            logo_askab: "https://i.ibb.co.com/TQ2hm2h/IMG-20251112-015234.jpg"
        };

        const NEWS_DATA = [
            {
                id_berita: "BRT-001",
                tanggal: "18/10/2025",
                Judul_berita: "ffff",
                isi_berita: "ddddddd",
                gambar_1: "https://i.ibb.co.com/1t4P2rN5/IMG-20251112-015057.jpg",
                gambar_2: "https://i.ibb.co.com/TQ2hm2h/IMG-20251112-015234.jpg",
                gambar_3: "https://i.ibb.co.com/HM79Rd6/IMG-20251112-015205.jpg"
            }
        ];

        const RAW_MATCH_DATA = [
            {
                id_match: "MATCH-001",
                id_kompetisi: "COMP-6231",
                nama_kompetisi: "MENTAWAI PREMIER LEAGUE 2025",
                babak_pertandingan: "Babak Fase Group Wilayah Sipora",
                tanggal_match: "11/22/2025",
                jam: "15:30",
                lokasi: "lapangan desa sipora jaya",
                id_klub_home: "APM-001",
                nama_klub_home: "MAICON FC",
                logo_klub_home: "https://i.ibb.co.com/V02rLmwm/f37a5f133a9c.jpg",
                goal_home: 1,
                keterangan_goal_home: "rima78",
                kartu_merah_home: 0,
                keterangan_kartu_merah_home: "-",
                kartu_kuning_home: 1,
                keterangan_kartu_kuning_home: "-",
                poin_home: 0,
                poin_away: 3,
                keterangan_kartu_kuning_away: "-",
                kartu_kuning_away: 0,
                keterangan_kartu_merah_away: "-",
                kartu_merah_away: 0,
                keterangan_goal_away: "rita,yani,andt",
                goal_away: 3,
                id_klub_away: "APM-001",
                nama_klub_away: "MAICON FC",
                logo_klub_away: "https://i.ibb.co.com/V02rLmwm/f37a5f133a9c.jpg"
            }
        ];

        const CLUB_DATA = [
            {
                id_klub: "APM-001",
                nama_klub: "MAICON FC",
                nama_manajer: "AFRI SURYANTO S,AP",
                no_telp_klub: "82283364484",
                alamat_klub: "Desa Sido Makmur, sipora utara",
                logo_klub: "https://i.ibb.co.com/V02rLmwm/f37a5f133a9c.jpg"
            }
        ];

        const PLAYER_DATA = [
            {
                id_pemain: "1111111111111111",
                id_klub: "APM-001",
                nama_pemain: "sdfgcegdfg",
                tanggal_lahir: "2018-10-22",
                no_punggung: 43,
                posisi: "Kiper",
                nama_punggung: "cedfds",
                pas_photo_pemain: "https://i.ibb.co.com/Vc0tD99W/1d61fd9785fb.png"
            }
        ];

        const OFFICIAL_DATA = [
            {
                id_official: "1111111111111111",
                id_klub: "APM-001",
                nama_official: "YASMIN",
                tanggal_lahir: "2018-10-22",
                jabatan: "Pelatih",
                pas_photo_official: "https://i.ibb.co.com/Vc0tD99W/1d61fd9785fb.png"
            }
        ];

        const COMPETITION_DATA = [
            {
                id_kompetisi: "COMP-6231",
                nama_kompetisi: "MENTAWAI PREMIER LEAGUE 2025",
                umur_maksimal: 80,
                tanggal_awal_pendaftaran: "2025-11-17",
                tanggal_akhir_pendaftaran: "2025-12-01",
                url_logo_liga: "https://i.ibb.co.com/whSSR80B/b875b5043f80.png",
                deskripsi: "KOMPETISI LIGA ASKAB MENTAWAI"
            }
        ];

        const SLIDE_DATA = [
            "https://i.ibb.co.com/7xZwq739/IMG-20251112-004726.jpg",
            "https://i.ibb.co.com/Rkgtqd8L/1762812029886.jpg",
            "https://i.ibb.co.com/23z5JLwp/1762812023240.jpg"
        ];

        const ABOUT_DATA = {
            nama_organisasi: "ASOSIASI KABUPATE PSSI KEPULAUAN MENTAWAI",
            tanggal_berdiri: "03-11-2020",
            visi: "hgsfhdsfsj",
            misi: "fgdgs",
            ketua: "H. Safawi M.Phil",
            wakil_ketua: "Syahroni Wardoyo S.Sos",
            sekretaris: "Rinaldi Kaslan S.Pd",
            bendahara: "Eranita Matondang S.E",
            humas: "Demian Zega S.sos",
            media: "Ardian Humaiza S.Kom"
        };

        const ADMIN_LOGIN_URL = "https://facebook.com";

        // ====================================================================
        // 2. STATE DAN UTILITY
        // ====================================================================

        let currentPage = 'home';
        let detailData = {}; // Untuk menyimpan data detail klub/match yang sedang dilihat
        let historyStack = ['home']; // Stack untuk mengelola riwayat halaman internal

        // Utility untuk membersihkan dan menstandarkan data match
        const MATCH_DATA = RAW_MATCH_DATA.map(match => {
            // Menggabungkan tanggal dan jam menjadi objek Date
            const [month, day, year] = match.tanggal_match.split('/');
            const [hour, minute] = match.jam.split(':');
            const dateStr = `${year}-${month}-${day}T${hour}:${minute}:00`;
            match.dateTime = new Date(dateStr);
            match.isUpcoming = match.dateTime > new Date();
            return match;
        });

        // Utility: Mengubah format tanggal DD/MM/YYYY atau YYYY-MM-DD menjadi Date object
        function parseDate(dateString) {
            if (!dateString) return null;
            if (dateString.includes('/')) {
                const [day, month, year] = dateString.split('/');
                return new Date(`${year}-${month}-${day}`);
            } else if (dateString.includes('-')) {
                 const [year, month, day] = dateString.split('-');
                 return new Date(year, month - 1, day);
            }
            return null;
        }

        // Utility: Menghitung umur dari tanggal lahir (YYYY-MM-DD)
        function calculateAge(dateString) {
            const birthDate = parseDate(dateString);
            if (!birthDate) return 'N/A';
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDifference = today.getMonth() - birthDate.getMonth();
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        // Utility: Sorting berita berdasarkan tanggal terbaru
        const SORTED_NEWS = NEWS_DATA.sort((a, b) => {
            const dateA = parseDate(a.tanggal);
            const dateB = parseDate(b.tanggal);
            return dateB - dateA; // Descending
        });

        // ====================================================================
        // 3. NAVIGASI DAN HISTORY
        // ====================================================================

        function showPage(pageName, pushToHistory = true, data = null) {
            const allPages = document.querySelectorAll('.page');
            const navLinks = document.querySelectorAll('#bottom-nav a');
            
            // Sembunyikan semua halaman
            allPages.forEach(page => page.classList.add('hidden'));

            // Tampilkan halaman yang diminta
            const targetPage = document.querySelector(`#${pageName}-page`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                currentPage = pageName;

                // Update detail data jika ada
                if (data) {
                    detailData[pageName] = data;
                }

                // Kelola riwayat
                if (pushToHistory && historyStack[historyStack.length - 1] !== pageName) {
                    historyStack.push(pageName);
                } else if (!pushToHistory && historyStack.length > 1) {
                    historyStack.pop();
                }

                // Render konten halaman
                renderPage(pageName);
            }

            // Update status aktif navigasi bawah
            navLinks.forEach(link => {
                link.classList.remove('active', 'text-red-500');
                link.classList.add('text-gray-500');
                if (link.dataset.page === getBasePageName(pageName)) {
                    link.classList.add('active', 'text-red-500');
                    link.classList.remove('text-gray-500');
                }
            });
        }

        function getBasePageName(pageName) {
            // Mengambil nama halaman utama dari halaman detail (e.g., 'klub-detail' -> 'klub')
            if (pageName.includes('-')) {
                return pageName.split('-')[0];
            }
            return pageName;
        }

        function goBack() {
            if (historyStack.length > 1) {
                historyStack.pop(); // Hapus halaman saat ini
                const prevPage = historyStack[historyStack.length - 1];
                // Panggil showPage tanpa pushToHistory
                showPage(prevPage, false);
            }
        }

        // Handler tombol kembali perangkat
        window.onpopstate = function(event) {
            // Karena kita menggunakan history internal, kita mencegah perilaku default
            // dan menggunakan fungsi goBack() kita sendiri
            goBack();
        };

        // Event listener untuk navigasi bawah
        document.getElementById('bottom-nav').addEventListener('click', (e) => {
            const link = e.target.closest('a');
            if (link) {
                e.preventDefault();
                const pageName = link.dataset.page;
                if (pageName && pageName !== currentPage) {
                    // Reset history saat pindah navigasi utama
                    historyStack = [pageName];
                    showPage(pageName);
                }
            }
        });

        function renderPage(pageName) {
            const pageMap = {
                'home': renderHome,
                'klasemen': renderKlasemen,
                'klub': renderKlub,
                'tentang': renderTentang,
                'klub-detail': renderKlubDetail
            };
            
            if (pageMap[pageName]) {
                const contentDiv = document.getElementById(`${pageName}-page`);
                if (contentDiv) {
                    showLoading();
                    setTimeout(() => { // Simulate API load/render time
                        pageMap[pageName](contentDiv);
                        hideLoading();
                    }, 100);
                }
            }
        }

        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // ====================================================================
        // 4. RENDER UTAMA
        // ====================================================================

        function renderHeader() {
            const headerEl = document.getElementById('app-header');
            headerEl.innerHTML = `
                <div class="flex items-center justify-between w-full">
                    <img src="${HEADER_DATA.logo_pssi}" alt="Logo PSSI" class="w-8 h-8 rounded-full shadow-inner lazy-img" onerror="this.src='https://placehold.co/50x50/e2e8f0/e2e8f0?text=PSSI'">
                    <h1 class="text-base font-bold text-gray-800 truncate px-2">${HEADER_DATA.Judul_kepala}</h1>
                    <img src="${HEADER_DATA.logo_askab}" alt="Logo Askab" class="w-8 h-8 rounded-full shadow-inner lazy-img" onerror="this.src='https://placehold.co/50x50/e2e8f0/e2e8f0?text=ASKAB'">
                </div>
            `;
        }

        // ====================================================================
        // 5. RENDER HOME (Berita)
        // ====================================================================

        let slideInterval;

        function renderHome(container) {
            // Hentikan slider lama
            clearInterval(slideInterval);

            container.innerHTML = `
                ${renderSearchBar('news-search', 'Cari Berita...')}
                <div id="slide-container" class="my-4 relative h-48 overflow-hidden rounded-xl shadow-lg">
                    <div id="slide-track" class="flex w-full h-full transition-transform duration-500 ease-in-out">
                        ${SLIDE_DATA.map((url, index) => `
                            <div class="w-full flex-shrink-0 h-full">
                                <img src="${url}" alt="Banner ${index + 1}" class="lazy-img w-full h-full object-cover" onerror="this.src='https://placehold.co/400x192/e2e8f0/64748b?text=Slide+${index + 1}'">
                            </div>
                        `).join('')}
                    </div>
                </div>
                <h2 class="text-lg font-bold text-gray-800 mb-3 mt-5">Berita Terbaru</h2>
                <div id="news-list" class="space-y-4">
                    <!-- News cards will be rendered here -->
                </div>
            `;
            
            // Inisialisasi Slider
            initSlider();

            // Render daftar berita
            renderNewsList(SORTED_NEWS);

            // Event listener untuk pencarian
            document.getElementById('news-search').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const filteredNews = SORTED_NEWS.filter(news => 
                    news.Judul_berita.toLowerCase().includes(query) || 
                    news.isi_berita.toLowerCase().includes(query)
                );
                renderNewsList(filteredNews);
            });
        }

        function initSlider() {
            const track = document.getElementById('slide-track');
            const slides = SLIDE_DATA.length;
            let currentSlide = 0;

            if (slides === 0) return;

            const updateSlide = () => {
                currentSlide = (currentSlide + 1) % slides;
                track.style.transform = `translateX(-${currentSlide * 100}%)`;
            };

            // Mulai geser otomatis setiap 2 detik
            slideInterval = setInterval(updateSlide, 2000);
        }

        function renderNewsList(newsArray) {
            const newsListEl = document.getElementById('news-list');
            if (!newsListEl) return;
            
            newsListEl.innerHTML = newsArray.map(news => `
                <div class="bg-white rounded-xl shadow-md overflow-hidden flex items-start p-3 hover:shadow-lg cursor-pointer transition-all" onclick="openNewsModal('${news.id_berita}')">
                    <img src="${news.gambar_1}" alt="Gambar Berita" class="lazy-img w-20 h-20 object-cover rounded-lg flex-shrink-0 mr-3" onerror="this.src='https://placehold.co/80x80/e2e8f0/64748b?text=News'">
                    <div class="flex-grow">
                        <p class="text-xs text-gray-500 mb-1">${news.tanggal}</p>
                        <h3 class="font-semibold text-gray-900 line-clamp-2">${news.Judul_berita}</h3>
                        <p class="text-sm text-gray-600 mt-1 line-clamp-2">${news.isi_berita.split(' ').slice(0, 20).join(' ')}...</p>
                    </div>
                </div>
            `).join('');
            
            if (newsArray.length === 0) {
                 newsListEl.innerHTML = '<p class="text-center text-gray-500 mt-8">Tidak ada berita yang ditemukan.</p>';
            }
        }

        function openNewsModal(newsId) {
            const news = NEWS_DATA.find(n => n.id_berita === newsId);
            if (!news) return;

            const content = `
                <h2 class="text-2xl font-bold mb-2">${news.Judul_berita}</h2>
                <p class="text-sm text-gray-500 mb-4 border-b pb-2">Tanggal: ${news.tanggal}</p>
                
                <div class="space-y-4 mb-6">
                    ${[news.gambar_1, news.gambar_2, news.gambar_3].filter(url => url).map((url, index) => `
                        <img src="${url}" alt="Gambar Berita ${index + 1}" class="lazy-img w-full rounded-lg shadow-md" onerror="this.src='https://placehold.co/400x200/e2e8f0/64748b?text=Gambar+${index + 1}'">
                    `).join('')}
                </div>
                
                <p class="text-gray-700 leading-relaxed whitespace-pre-wrap">${news.isi_berita}</p>
            `;

            document.getElementById('news-modal-content').innerHTML = content;
            document.getElementById('news-modal').classList.remove('hidden');
        }

        // ====================================================================
        // 6. RENDER KLASEMEN (Match)
        // ====================================================================

        let countdownInterval;

        function renderKlasemen(container) {
            clearInterval(countdownInterval); // Hentikan countdown lama
            
            const uniqueCompetitions = [...new Set(MATCH_DATA.map(m => m.nama_kompetisi))];
            
            container.innerHTML = `
                ${renderSearchBar('match-search', 'Cari Pertandingan...')}
                <h2 class="text-lg font-bold text-gray-800 mb-3 mt-5">Pilih Kompetisi</h2>
                
                <div id="competition-list" class="grid grid-cols-2 gap-3 mb-6">
                    ${uniqueCompetitions.map(compName => {
                        const comp = COMPETITION_DATA.find(c => c.nama_kompetisi === compName) || {};
                        return `
                            <div class="bg-white p-4 rounded-xl shadow-md text-center cursor-pointer hover:bg-red-50 transition-all" onclick="renderMatchDetail('${compName}')">
                                <img src="${comp.url_logo_liga || 'https://placehold.co/80x80/e2e8f0/64748b?text=Liga'}" alt="Logo Liga" class="lazy-img w-12 h-12 mx-auto mb-2 rounded-lg" onerror="this.src='https://placehold.co/80x80/e2e8f0/64748b?text=Liga'">
                                <p class="text-sm font-semibold">${compName}</p>
                            </div>
                        `;
                    }).join('')}
                </div>

                <h2 class="text-lg font-bold text-gray-800 mb-3 mt-5">Semua Hasil & Jadwal</h2>
                <div id="all-matches-list">
                    <!-- Semua match akan dirender di sini -->
                </div>
            `;
            
            renderMatchList(MATCH_DATA, 'all-matches-list');

            document.getElementById('match-search').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const filteredMatches = MATCH_DATA.filter(match => 
                    match.nama_klub_home.toLowerCase().includes(query) || 
                    match.nama_klub_away.toLowerCase().includes(query) ||
                    match.babak_pertandingan.toLowerCase().includes(query)
                );
                renderMatchList(filteredMatches, 'all-matches-list');
            });
        }
        
        function renderMatchDetail(compName) {
            const matches = MATCH_DATA.filter(m => m.nama_kompetisi === compName);
            const uniqueBabak = [...new Set(matches.map(m => m.babak_pertandingan))];
            
            const detailContainer = document.getElementById('klasemen-page');
            detailContainer.innerHTML = `
                <button onclick="showPage('klasemen', false)" class="text-red-500 mb-4 block"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
                <h1 class="text-xl font-bold mb-4">${compName}</h1>
                
                <div id="babak-tabs" class="flex overflow-x-auto space-x-2 mb-4 p-1 rounded-lg bg-white shadow-inner">
                    ${uniqueBabak.map((babak, index) => `
                        <button class="babak-tab flex-shrink-0 px-4 py-2 text-sm font-medium rounded-lg transition-all ${index === 0 ? 'bg-red-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}" 
                                data-babak="${babak}" 
                                onclick="filterMatchesByBabak(this, '${babak}', '${compName}')">
                            ${babak}
                        </button>
                    `).join('')}
                </div>
                
                <h2 class="text-lg font-bold text-gray-800 mb-3">Jadwal & Hasil Pertandingan</h2>
                <div id="filtered-matches-list" class="space-y-4">
                    <!-- Matches for the first babak will be rendered here -->
                </div>
            `;
            
            // Render match list untuk babak pertama
            if (uniqueBabak.length > 0) {
                filterMatchesByBabak(document.querySelector('.babak-tab'), uniqueBabak[0], compName);
            }
        }
        
        function filterMatchesByBabak(el, babak, compName) {
             document.querySelectorAll('.babak-tab').forEach(btn => {
                 btn.classList.remove('bg-red-500', 'text-white');
                 btn.classList.add('bg-gray-100', 'text-gray-600');
             });
             el.classList.add('bg-red-500', 'text-white');
             el.classList.remove('bg-gray-100', 'text-gray-600');
            
            const filteredMatches = MATCH_DATA.filter(m => m.nama_kompetisi === compName && m.babak_pertandingan === babak);
            renderMatchList(filteredMatches, 'filtered-matches-list');
        }

        function renderMatchList(matches, elementId) {
            clearInterval(countdownInterval); // Hentikan countdown lama
            const listEl = document.getElementById(elementId);
            if (!listEl) return;

            // Sort: Upcoming first, then by date descending
            matches.sort((a, b) => {
                if (a.isUpcoming && !b.isUpcoming) return -1;
                if (!a.isUpcoming && b.isUpcoming) return 1;
                return b.dateTime - a.dateTime;
            });

            listEl.innerHTML = matches.map(match => {
                const statusHtml = match.isUpcoming 
                    ? `<div class="text-xs font-semibold text-blue-500 mb-2">JADWAL (${match.tanggal_match} ${match.jam})</div><div id="countdown-${match.id_match}" class="text-sm font-bold text-gray-700"></div>`
                    : `<div class="text-2xl font-black text-red-500">${match.goal_home} - ${match.goal_away}</div><div class="text-xs text-gray-500">SELESAI</div>`;
                
                const cardClass = match.isUpcoming ? 'border-blue-500 border-2 bg-blue-50' : 'border-gray-200 border bg-white';

                return `
                    <div class="p-4 rounded-xl shadow-lg ${cardClass} flex flex-col space-y-3">
                        <div class="text-xs text-center font-medium text-gray-600 mb-2">${match.nama_kompetisi} - ${match.babak_pertandingan}</div>
                        ${match.isUpcoming ? `<div class="text-sm text-center font-semibold text-gray-700">${match.lokasi}</div>` : ''}

                        <div class="flex justify-between items-center text-center">
                            <!-- Klub Home -->
                            <div class="flex flex-col items-center w-5/12">
                                <img src="${match.logo_klub_home}" alt="${match.nama_klub_home}" class="lazy-img w-16 h-16 rounded-full shadow-md mb-2" onerror="this.src='https://placehold.co/64x64/e2e8f0/64748b?text=H'">
                                <p class="text-sm font-bold truncate">${match.nama_klub_home}</p>
                                <p class="text-xs text-gray-500">(${match.id_klub_home})</p>
                            </div>

                            <!-- Score/Countdown -->
                            <div class="w-2/12 flex flex-col items-center justify-center">
                                ${statusHtml}
                            </div>

                            <!-- Klub Away -->
                            <div class="flex flex-col items-center w-5/12">
                                <img src="${match.logo_klub_away}" alt="${match.nama_klub_away}" class="lazy-img w-16 h-16 rounded-full shadow-md mb-2" onerror="this.src='https://placehold.co/64x64/e2e8f0/64748b?text=A'">
                                <p class="text-sm font-bold truncate">${match.nama_klub_away}</p>
                                <p class="text-xs text-gray-500">(${match.id_klub_away})</p>
                            </div>
                        </div>
                        
                        ${!match.isUpcoming ? renderMatchDetailSummary(match) : ''}
                    </div>
                `;
            }).join('');
            
            // Start countdowns if needed
            if (matches.some(m => m.isUpcoming)) {
                countdownInterval = setInterval(() => updateCountdowns(matches), 1000);
            }
            
            if (matches.length === 0) {
                 listEl.innerHTML = '<p class="text-center text-gray-500 mt-8">Tidak ada pertandingan ditemukan.</p>';
            }
        }
        
        function renderMatchDetailSummary(match) {
            return `
                <div class="pt-3 border-t border-gray-100 mt-3">
                    <div class="flex justify-between text-xs font-semibold mb-2">
                        <span>Poin: ${match.poin_home}</span>
                        <span>Poin: ${match.poin_away}</span>
                    </div>
                    <div class="text-xs text-gray-700 space-y-1">
                        <p><strong>Gol Home:</strong> ${match.keterangan_goal_home || '-'}</p>
                        <p><strong>Gol Away:</strong> ${match.keterangan_goal_away || '-'}</p>
                        <p><strong>Kartu Kuning:</strong> ${match.kartu_kuning_home} vs ${match.kartu_kuning_away}</p>
                        <p><strong>Kartu Merah:</strong> ${match.kartu_merah_home} vs ${match.kartu_merah_away}</p>
                    </div>
                </div>
            `;
        }

        function updateCountdowns(matches) {
            matches.filter(m => m.isUpcoming).forEach(match => {
                const countdownEl = document.getElementById(`countdown-${match.id_match}`);
                if (!countdownEl) return;

                const now = new Date().getTime();
                const distance = match.dateTime.getTime() - now;

                if (distance < 0) {
                    countdownEl.innerHTML = "SEDANG BERLANGSUNG";
                    // Jika match sudah lewat, hapus countdown dan panggil render ulang match list
                    if (distance < -60000) { // Lebih dari 1 menit lalu
                         match.isUpcoming = false;
                         // Panggil render ulang untuk memuat hasil match (simulasi)
                    }
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                countdownEl.innerHTML = `${days}H ${hours}J ${minutes}M ${seconds}D`;
            });
        }

        // ====================================================================
        // 7. RENDER KLUB
        // ====================================================================

        function renderKlub(container) {
            container.innerHTML = `
                ${renderSearchBar('club-search', 'Cari Klub/Pemain/Official...')}
                <h2 class="text-lg font-bold text-gray-800 mb-3 mt-5">Daftar Klub</h2>
                <div id="club-list" class="grid grid-cols-2 gap-3 mb-6">
                    <!-- Club cards will be rendered here -->
                </div>
            `;
            
            // Render daftar klub
            renderClubList(CLUB_DATA);
            
            // Event listener untuk pencarian
            document.getElementById('club-search').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const filteredClubs = CLUB_DATA.filter(club => club.nama_klub.toLowerCase().includes(query));
                
                // Tambahan filter untuk Pemain dan Official
                const filteredPlayers = PLAYER_DATA.filter(p => p.nama_pemain.toLowerCase().includes(query) || p.nama_punggung.toLowerCase().includes(query));
                const filteredOfficials = OFFICIAL_DATA.filter(o => o.nama_official.toLowerCase().includes(query) || o.jabatan.toLowerCase().includes(query));

                // Jika query kosong, tampilkan semua klub
                if (!query) {
                    renderClubList(CLUB_DATA);
                } else {
                    // Jika ada hasil pencarian di pemain/official, tampilkan klub mereka
                    const clubIdsFromPlayers = filteredPlayers.map(p => p.id_klub);
                    const clubIdsFromOfficials = filteredOfficials.map(o => o.id_klub);
                    const allRelevantIds = new Set([...filteredClubs.map(c => c.id_klub), ...clubIdsFromPlayers, ...clubIdsFromOfficials]);
                    
                    const finalClubs = CLUB_DATA.filter(c => allRelevantIds.has(c.id_klub));
                    renderClubList(finalClubs);
                }
            });
        }
        
        function renderClubList(clubs) {
            const clubListEl = document.getElementById('club-list');
            if (!clubListEl) return;
            
            clubListEl.innerHTML = clubs.map(club => `
                <div class="bg-white p-4 rounded-xl shadow-md text-center cursor-pointer hover:bg-red-50 transition-all" onclick="showPage('klub-detail', true, '${club.id_klub}')">
                    <img src="${club.logo_klub}" alt="Logo Klub" class="lazy-img w-16 h-16 mx-auto mb-2 rounded-full border border-gray-100 shadow-inner" onerror="this.src='https://placehold.co/64x64/e2e8f0/64748b?text=Klub'">
                    <p class="text-sm font-bold truncate">${club.nama_klub}</p>
                    <p class="text-xs text-gray-500">${club.id_klub}</p>
                </div>
            `).join('');
            
            if (clubs.length === 0) {
                 clubListEl.innerHTML = '<p class="col-span-2 text-center text-gray-500 mt-8">Tidak ada klub yang ditemukan.</p>';
            }
        }

        function renderKlubDetail(container) {
            const clubId = detailData['klub-detail'];
            const club = CLUB_DATA.find(c => c.id_klub === clubId);
            if (!club) {
                container.innerHTML = '<p class="text-center text-red-500 mt-8">Data klub tidak ditemukan.</p>';
                return;
            }

            const clubMatches = MATCH_DATA.filter(m => m.id_klub_home === clubId || m.id_klub_away === clubId);
            const players = PLAYER_DATA.filter(p => p.id_klub === clubId);
            const officials = OFFICIAL_DATA.filter(o => o.id_klub === clubId);
            
            container.innerHTML = `
                <button onclick="showPage('klub', false)" class="text-red-500 mb-4 block"><i class="fas fa-arrow-left mr-2"></i>Kembali ke Daftar Klub</button>
                
                <div class="bg-white p-4 rounded-xl shadow-lg mb-6 text-center">
                    <img src="${club.logo_klub}" alt="Logo Klub" class="lazy-img w-20 h-20 mx-auto mb-3 rounded-full border-4 border-red-500 shadow-xl" onerror="this.src='https://placehold.co/80x80/e2e8f0/64748b?text=Klub'">
                    <h1 class="text-2xl font-bold mb-1 text-gray-900">${club.nama_klub}</h1>
                    <p class="text-sm text-gray-500 mb-3">${club.alamat_klub}</p>
                    
                    <div class="grid grid-cols-2 text-left text-sm mt-3 border-t pt-3">
                        <p><strong class="font-semibold">Manajer:</strong> ${club.nama_manajer}</p>
                        <p><strong class="font-semibold">Telp:</strong> ${club.no_telp_klub}</p>
                    </div>
                </div>

                <h2 class="text-lg font-bold text-gray-800 mb-3">Rekap Match (${clubMatches.length} Pertandingan)</h2>
                <div id="club-match-recap" class="space-y-3 mb-6">
                    ${clubMatches.length > 0 ? clubMatches.map(m => renderMatchCardSimple(m, clubId)).join('') : '<p class="text-center text-gray-500">Belum ada data pertandingan.</p>'}
                </div>

                <!-- Tabs Pemain & Official -->
                <div class="bg-white rounded-xl shadow-lg">
                    <div class="flex border-b border-gray-100">
                        <button id="tab-pemain" class="w-1/2 py-3 text-center font-bold text-red-500 border-b-2 border-red-500 transition-all" onclick="toggleClubDetailTab('pemain')">Pemain</button>
                        <button id="tab-official" class="w-1/2 py-3 text-center font-bold text-gray-500 transition-all" onclick="toggleClubDetailTab('official')">Official</button>
                    </div>
                    <div id="tab-content-pemain" class="p-4 grid grid-cols-2 gap-3">
                        ${players.length > 0 ? players.map(p => renderPlayerCard(p)).join('') : '<p class="col-span-2 text-center text-gray-500">Tidak ada data pemain.</p>'}
                    </div>
                    <div id="tab-content-official" class="p-4 grid grid-cols-2 gap-3 hidden">
                        ${officials.length > 0 ? officials.map(o => renderOfficialCard(o)).join('') : '<p class="col-span-2 text-center text-gray-500">Tidak ada data official.</p>'}
                    </div>
                </div>
            `;
        }
        
        function renderMatchCardSimple(match, clubId) {
            const isHome = match.id_klub_home === clubId;
            const myScore = isHome ? match.goal_home : match.goal_away;
            const opponentScore = isHome ? match.goal_away : match.goal_home;
            const opponentName = isHome ? match.nama_klub_away : match.nama_klub_home;
            const opponentLogo = isHome ? match.logo_klub_away : match.logo_klub_home;
            const point = isHome ? match.poin_home : match.poin_away;
            
            const statusClass = match.isUpcoming ? 'bg-blue-100 text-blue-800' : 
                                point === 3 ? 'bg-green-100 text-green-800' :
                                point === 1 ? 'bg-yellow-100 text-yellow-800' :
                                'bg-red-100 text-red-800';
                                
            const statusText = match.isUpcoming ? 'Jadwal' :
                                point === 3 ? 'Menang' :
                                point === 1 ? 'Seri' :
                                'Kalah';
            
            return `
                <div class="bg-white p-3 rounded-xl shadow-md flex items-center justify-between transition-all">
                    <div class="flex flex-col items-start w-5/12">
                        <p class="text-xs text-gray-500 mb-1">${match.tanggal_match}</p>
                        <p class="text-sm font-semibold truncate">vs ${opponentName}</p>
                    </div>
                    
                    <div class="flex items-center justify-center w-2/12 font-bold text-lg">
                        ${match.isUpcoming ? '-' : `${myScore}:${opponentScore}`}
                    </div>
                    
                    <div class="w-5/12 flex flex-col items-end">
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${statusClass}">${statusText}</span>
                        ${!match.isUpcoming ? `<p class="text-xs text-gray-600 mt-1">Poin: ${point}</p>` : `<p class="text-xs text-gray-600 mt-1">${match.jam}</p>`}
                    </div>
                </div>
            `;
        }

        function renderPlayerCard(player) {
            const age = calculateAge(player.tanggal_lahir);
            return `
                <div class="bg-gray-50 p-3 rounded-xl shadow-sm text-center border border-gray-100">
                    <img src="${player.pas_photo_pemain}" alt="Foto Pemain" class="lazy-img w-16 h-16 mx-auto mb-2 rounded-full object-cover" onerror="this.src='https://placehold.co/64x64/e2e8f0/64748b?text=Pemain'">
                    <p class="text-sm font-bold truncate">${player.nama_pemain}</p>
                    <p class="text-xs text-gray-600">No. ${player.no_punggung} (${player.nama_punggung})</p>
                    <p class="text-xs text-red-500 font-semibold">${player.posisi} (${age} Thn)</p>
                </div>
            `;
        }

        function renderOfficialCard(official) {
            const age = calculateAge(official.tanggal_lahir);
            return `
                <div class="bg-gray-50 p-3 rounded-xl shadow-sm text-center border border-gray-100">
                    <img src="${official.pas_photo_official}" alt="Foto Official" class="lazy-img w-16 h-16 mx-auto mb-2 rounded-full object-cover" onerror="this.src='https://placehold.co/64x64/e2e8f0/64748b?text=Official'">
                    <p class="text-sm font-bold truncate">${official.nama_official}</p>
                    <p class="text-xs text-red-500 font-semibold">${official.jabatan} (${age} Thn)</p>
                </div>
            `;
        }

        function toggleClubDetailTab(activeTab) {
            const tabs = ['pemain', 'official'];
            tabs.forEach(tab => {
                const tabBtn = document.getElementById(`tab-${tab}`);
                const tabContent = document.getElementById(`tab-content-${tab}`);
                if (tab === activeTab) {
                    tabBtn.classList.add('text-red-500', 'border-b-2', 'border-red-500');
                    tabBtn.classList.remove('text-gray-500', 'border-b-0');
                    tabContent.classList.remove('hidden');
                } else {
                    tabBtn.classList.remove('text-red-500', 'border-b-2', 'border-red-500');
                    tabBtn.classList.add('text-gray-500', 'border-b-0');
                    tabContent.classList.add('hidden');
                }
            });
        }


        // ====================================================================
        // 8. RENDER TENTANG
        // ====================================================================

        function renderTentang(container) {
            container.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                    <h1 class="text-xl font-bold mb-4 text-center text-red-600">${ABOUT_DATA.nama_organisasi}</h1>
                    <p class="text-sm text-gray-500 text-center mb-6">Berdiri sejak: ${ABOUT_DATA.tanggal_berdiri}</p>
                    
                    <div class="space-y-4">
                        <div class="border-l-4 border-red-500 pl-3">
                            <p class="text-lg font-semibold text-gray-800">Visi</p>
                            <p class="text-gray-700">${ABOUT_DATA.visi}</p>
                        </div>
                        <div class="border-l-4 border-red-500 pl-3">
                            <p class="text-lg font-semibold text-gray-800">Misi</p>
                            <p class="text-gray-700">${ABOUT_DATA.misi}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                    <h2 class="text-lg font-bold mb-4 text-gray-800">Struktur Organisasi</h2>
                    <dl class="space-y-3">
                        ${Object.entries(ABOUT_DATA).filter(([key]) => ['ketua', 'wakil_ketua', 'sekretaris', 'bendahara', 'humas', 'media'].includes(key)).map(([key, value]) => `
                            <div class="flex justify-between items-center border-b pb-2">
                                <dt class="text-sm font-semibold capitalize text-gray-600">${key.replace('_', ' ')}</dt>
                                <dd class="text-base font-medium text-gray-900">${value}</dd>
                            </div>
                        `).join('')}
                    </dl>
                </div>
                
                <a href="${ADMIN_LOGIN_URL}" target="_blank" class="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-xl shadow-sm text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all">
                    <i class="fas fa-sign-in-alt mr-2"></i>
                    Login Admin
                </a>
            `;
        }


        // ====================================================================
        // 9. RENDER KOMPONEN UMUM
        // ====================================================================

        function renderSearchBar(id, placeholder) {
            return `
                <div class="relative mt-2 mb-4">
                    <input type="text" id="${id}" placeholder="${placeholder}" class="w-full py-3 pl-10 pr-4 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            `;
        }

        // ====================================================================
        // 10. INISIALISASI
        // ====================================================================

        window.onload = () => {
            renderHeader();
            // Tampilkan halaman awal
            showPage('home', false);
        };

    </script>

</body>
</html>
